# Detector Test Suite

This directory contains scripts to verify the functionality and performance of the drone detector.

## Tests

### 1. `test_detector.sh`
**Purpose**: Verifies the basic object detection pipeline.
- Streams a recorded video (`cala_del_moral.ts`) to RTSP.
- Runs the detector in `basic` mode.
- Outputs an RTSP stream with bounding box overlays.
- **Usage**: `./test_detector.sh`

### 2. `test_id3_mode.sh`
**Purpose**: Verifies the ID3 metadata synchronization.
- Streams the recorded video.
- Runs the detector in `id3` mode (pure GStreamer pipeline).
- Injects JSON metadata (detections, telemetry) as ID3 tags into the MPEG-TS stream.
- Verifies the output stream exists and attempts to read metadata.
- **Usage**: `./test_id3_mode.sh`

### 3. `test_id3_reader.py`
**Purpose**: A Python script to read the RTSP stream and extract ID3 tags.
- Used by `test_id3_mode.sh`.
- Uses `av` (PyAV) to demux the stream.
- Saves captured frames and metadata to `captured_data/`.
- **Usage**: `python test_id3_reader.py <rtsp_url> <duration>`

### 4. `extract_metadata.py`
**Purpose**: A helper script to extract ID3 metadata from a JSON packet dump.
- Useful when `test_id3_reader.py` fails due to library compatibility issues.
- Parses `captured_data/packets.json` (generated by `ffprobe`).
- **Usage**: `python extract_metadata.py`

## Setup
Ensure the `drone_detector` conda environment is activated:
```bash
conda activate drone_detector
```
All scripts should be run from this directory (`tests/`). They automatically handle paths to the source code in `../src`.
