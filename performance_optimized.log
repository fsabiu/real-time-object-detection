Starting test with recorded stream...

Step 1: Starting FFmpeg stream (Terminal 1)
This will stream cala_del_moral.ts to rtsp://localhost:8554/klvstream

FFmpeg started (PID: 4012225)
Waiting 5 seconds for stream to stabilize...
ffmpeg version 7.1.1 Copyright (c) 2000-2025 the FFmpeg developers
  built with gcc 14.3.0 (conda-forge gcc 14.3.0-5)
  configuration: --prefix=/home/ubuntu/miniforge/envs/drone_detector --cc=/home/conda/feedstock_root/build_artifacts/ffmpeg_1757214059462/_build_env/bin/x86_64-conda-linux-gnu-cc --cxx=/home/conda/feedstock_root/build_artifacts/ffmpeg_1757214059462/_build_env/bin/x86_64-conda-linux-gnu-c++ --nm=/home/conda/feedstock_root/build_artifacts/ffmpeg_1757214059462/_build_env/bin/x86_64-conda-linux-gnu-nm --ar=/home/conda/feedstock_root/build_artifacts/ffmpeg_1757214059462/_build_env/bin/x86_64-conda-linux-gnu-ar --disable-doc --enable-openssl --enable-demuxer=dash --enable-hardcoded-tables --enable-libfreetype --enable-libharfbuzz --enable-libfontconfig --enable-libopenh264 --enable-libdav1d --disable-gnutls --enable-libvpx --enable-libass --enable-pthreads --enable-alsa --enable-libpulse --enable-vaapi --enable-libvpl --enable-libopenvino --enable-gpl --enable-libx264 --enable-libx265 --enable-libmp3lame --enable-libaom --enable-libsvtav1 --enable-libxml2 --enable-pic --enable-shared --disable-static --enable-version3 --enable-zlib --enable-libvorbis --enable-libopus --enable-librsvg --enable-ffplay --pkg-config=/home/conda/feedstock_root/build_artifacts/ffmpeg_1757214059462/_build_env/bin/pkg-config
  libavutil      59. 39.100 / 59. 39.100
  libavcodec     61. 19.101 / 61. 19.101
  libavformat    61.  7.100 / 61.  7.100
  libavdevice    61.  3.100 / 61.  3.100
  libavfilter    10.  4.100 / 10.  4.100
  libswscale      8.  3.100 /  8.  3.100
  libswresample   5.  3.100 /  5.  3.100
  libpostproc    58.  3.100 / 58.  3.100
[mpegts @ 0x5a6db0a10b00] start time for stream 1 is not set in estimate_timings_from_pts
Input #0, mpegts, from '/home/ubuntu/drones/cala_del_moral.ts':
  Duration: 00:09:37.49, start: 1.633456, bitrate: 4482 kb/s
  Program 1 
    Metadata:
      service_name    : Service01
      service_provider: FFmpeg
  Stream #0:0[0x100]: Video: h264 (Main) ([27][0][0][0] / 0x001B), yuv420p(tv, bt709, progressive), 1280x720 [SAR 1:1 DAR 16:9], 29.97 fps, 29.97 tbr, 90k tbn
  Stream #0:1[0x101]: Data: klv (KLVA / 0x41564C4B)
Stream mapping:
  Stream #0:0 -> #0:0 (copy)
Output #0, rtsp, to 'rtsp://localhost:8554/klvstream':
  Metadata:
    encoder         : Lavf61.7.100
  Stream #0:0: Video: h264 (Main) ([27][0][0][0] / 0x001B), yuv420p(tv, bt709, progressive), 1280x720 [SAR 1:1 DAR 16:9], q=2-31, 29.97 fps, 29.97 tbr, 90k tbn
Press [q] to stop, [?] for help
frame=   30 fps=0.0 q=-1.0 size=N/A time=00:00:01.00 bitrate=N/A speed=   2x    frame=   45 fps= 45 q=-1.0 size=N/A time=00:00:01.50 bitrate=N/A speed= 1.5x    frame=   60 fps= 40 q=-1.0 size=N/A time=00:00:02.00 bitrate=N/A speed=1.33x    frame=   75 fps= 37 q=-1.0 size=N/A time=00:00:02.50 bitrate=N/A speed=1.25x    frame=   90 fps= 36 q=-1.0 size=N/A time=00:00:03.00 bitrate=N/A speed= 1.2x    frame=  105 fps= 35 q=-1.0 size=N/A time=00:00:03.50 bitrate=N/A speed=1.17x    frame=  120 fps= 34 q=-1.0 size=N/A time=00:00:04.00 bitrate=N/A speed=1.14x    frame=  135 fps= 34 q=-1.0 size=N/A time=00:00:04.50 bitrate=N/A speed=1.13x    frame=  150 fps= 33 q=-1.0 size=N/A time=00:00:05.00 bitrate=N/A speed=1.11x    
Step 2: Starting detector (Terminal 2)
This will run the detector on the stream

frame=  165 fps= 33 q=-1.0 size=N/A time=00:00:05.50 bitrate=N/A speed= 1.1x    frame=  180 fps= 33 q=-1.0 size=N/A time=00:00:06.00 bitrate=N/A speed=1.09x    frame=  195 fps= 32 q=-1.0 size=N/A time=00:00:06.50 bitrate=N/A speed=1.08x    2025-12-03 14:25:31,137 - INFO - Loading YOLO model: yolov8n.pt
2025-12-03 14:25:31,173 - INFO - Opening SRT stream: rtsp://localhost:8554/klvstream
frame=  210 fps= 32 q=-1.0 size=N/A time=00:00:07.00 bitrate=N/A speed=1.08x    frame=  225 fps= 32 q=-1.0 size=N/A time=00:00:07.50 bitrate=N/A speed=1.07x    frame=  240 fps= 32 q=-1.0 size=N/A time=00:00:08.00 bitrate=N/A speed=1.07x    frame=  255 fps= 32 q=-1.0 size=N/A time=00:00:08.50 bitrate=N/A speed=1.06x    2025-12-03 14:25:33,447 - INFO - Starting capture thread
2025-12-03 14:25:33,447 - INFO - Initializing writer: 1280x720 @ 29.97002997002997fps
2025-12-03 14:25:33,447 - INFO - Creating GStreamer VideoWriter (hybrid mode with system Python)â€¦
2025-12-03 14:25:33,448 - INFO -   Pipeline: appsrc ! videoconvert ! video/x-raw,format=I420 ! queue max-size-buffers=0 max-size-bytes=0 max-size-time=200000000 leaky=downstream ! x264enc bitrate=6000 speed-preset=fast tune=zerolatency key-int-max=60 ! video/x-h264,profile=main ! h264parse ! queue max-size-buffers=0 max-size-bytes=0 max-size-time=100000000 leaky=downstream ! rtspclientsink location=rtsp://localhost:8554/detected_stream protocols=tcp latency=200
frame=  270 fps= 32 q=-1.0 size=N/A time=00:00:09.00 bitrate=N/A speed=1.06x    2025-12-03 14:25:33,702 - INFO - Service: DEBUG: Pipeline: appsrc ! videoconvert ! video/x-raw,format=I420 ! queue max-size-buffers=0 max-size-bytes=0 max-size-time=200000000 leaky=downstream ! x264enc bitrate=6000 speed-preset=fast tune=zerolatency key-int-max=60 ! video/x-h264,profile=main ! h264parse ! queue max-size-buffers=0 max-size-bytes=0 max-size-time=100000000 leaky=downstream ! rtspclientsink location=rtsp://localhost:8554/detected_stream protocols=tcp latency=200
2025-12-03 14:25:33,717 - INFO - Service: DEBUG: FPS: 29.97002997002997, Width: 1280, Height: 720
2025-12-03 14:25:33,717 - INFO - Service: READY
2025-12-03 14:25:33,717 - INFO - GStreamer writer service started successfully
frame=  285 fps= 32 q=-1.0 size=N/A time=00:00:09.50 bitrate=N/A speed=1.06x    frame=  300 fps= 32 q=-1.0 size=N/A time=00:00:10.00 bitrate=N/A speed=1.05x    frame=  315 fps= 31 q=-1.0 size=N/A time=00:00:10.50 bitrate=N/A speed=1.05x    2025-12-03 14:25:35,450 - INFO - Starting inference thread
2025-12-03 14:25:35,450 - INFO - Starting output thread
frame=  330 fps= 31 q=-1.0 size=N/A time=00:00:11.01 bitrate=N/A speed=1.05x    /home/ubuntu/miniforge/envs/drone_detector/lib/python3.10/site-packages/torch/cuda/__init__.py:827: UserWarning: Can't initialize NVML
  warnings.warn("Can't initialize NVML")
frame=  345 fps= 31 q=-1.0 size=N/A time=00:00:11.51 bitrate=N/A speed=1.05x    frame=  360 fps= 31 q=-1.0 size=N/A time=00:00:12.01 bitrate=N/A speed=1.04x    frame=  375 fps= 31 q=-1.0 size=N/A time=00:00:12.51 bitrate=N/A speed=1.04x    frame=  390 fps= 31 q=-1.0 size=N/A time=00:00:13.01 bitrate=N/A speed=1.04x    frame=  405 fps= 31 q=-1.0 size=N/A time=00:00:13.51 bitrate=N/A speed=1.04x    frame=  420 fps= 31 q=-1.0 size=N/A time=00:00:14.01 bitrate=N/A speed=1.04x    frame=  435 fps= 31 q=-1.0 size=N/A time=00:00:14.51 bitrate=N/A speed=1.04x    frame=  450 fps= 31 q=-1.0 size=N/A time=00:00:15.01 bitrate=N/A speed=1.04x    frame=  465 fps= 31 q=-1.0 size=N/A time=00:00:15.51 bitrate=N/A speed=1.03x    frame=  480 fps= 31 q=-1.0 size=N/A time=00:00:16.01 bitrate=N/A speed=1.03x    frame=  495 fps= 31 q=-1.0 size=N/A time=00:00:16.51 bitrate=N/A speed=1.03x    frame=  510 fps= 31 q=-1.0 size=N/A time=00:00:17.01 bitrate=N/A speed=1.03x    frame=  525 fps= 31 q=-1.0 size=N/A time=00:00:17.51 bitrate=N/A speed=1.03x    frame=  540 fps= 31 q=-1.0 size=N/A time=00:00:18.01 bitrate=N/A speed=1.03x    frame=  555 fps= 31 q=-1.0 size=N/A time=00:00:18.51 bitrate=N/A speed=1.03x    frame=  570 fps= 31 q=-1.0 size=N/A time=00:00:19.02 bitrate=N/A speed=1.03x    frame=  585 fps= 31 q=-1.0 size=N/A time=00:00:19.52 bitrate=N/A speed=1.03x    frame=  600 fps= 31 q=-1.0 size=N/A time=00:00:20.02 bitrate=N/A speed=1.03x    frame=  615 fps= 31 q=-1.0 size=N/A time=00:00:20.52 bitrate=N/A speed=1.03x    frame=  630 fps= 31 q=-1.0 size=N/A time=00:00:21.02 bitrate=N/A speed=1.03x    frame=  645 fps= 31 q=-1.0 size=N/A time=00:00:21.52 bitrate=N/A speed=1.02x    frame=  660 fps= 31 q=-1.0 size=N/A time=00:00:22.02 bitrate=N/A speed=1.02x    frame=  675 fps= 31 q=-1.0 size=N/A time=00:00:22.52 bitrate=N/A speed=1.02x    frame=  690 fps= 31 q=-1.0 size=N/A time=00:00:23.02 bitrate=N/A speed=1.02x    frame=  705 fps= 31 q=-1.0 size=N/A time=00:00:23.52 bitrate=N/A speed=1.02x    frame=  720 fps= 31 q=-1.0 size=N/A time=00:00:24.02 bitrate=N/A speed=1.02x    frame=  735 fps= 31 q=-1.0 size=N/A time=00:00:24.52 bitrate=N/A speed=1.02x    frame=  750 fps= 31 q=-1.0 size=N/A time=00:00:25.02 bitrate=N/A speed=1.02x    frame=  765 fps= 31 q=-1.0 size=N/A time=00:00:25.52 bitrate=N/A speed=1.02x    frame=  780 fps= 31 q=-1.0 size=N/A time=00:00:26.02 bitrate=N/A speed=1.02x    frame=  795 fps= 31 q=-1.0 size=N/A time=00:00:26.52 bitrate=N/A speed=1.02x    frame=  810 fps= 31 q=-1.0 size=N/A time=00:00:27.02 bitrate=N/A speed=1.02x    frame=  825 fps= 31 q=-1.0 size=N/A time=00:00:27.52 bitrate=N/A speed=1.02x    frame=  840 fps= 31 q=-1.0 size=N/A time=00:00:28.02 bitrate=N/A speed=1.02x    frame=  855 fps= 31 q=-1.0 size=N/A time=00:00:28.52 bitrate=N/A speed=1.02x    frame=  870 fps= 31 q=-1.0 size=N/A time=00:00:29.02 bitrate=N/A speed=1.02x    frame=  885 fps= 31 q=-1.0 size=N/A time=00:00:29.52 bitrate=N/A speed=1.02x    frame=  900 fps= 31 q=-1.0 size=N/A time=00:00:30.02 bitrate=N/A speed=1.02x    frame=  915 fps= 30 q=-1.0 size=N/A time=00:00:30.53 bitrate=N/A speed=1.02x    frame=  930 fps= 30 q=-1.0 size=N/A time=00:00:31.03 bitrate=N/A speed=1.02x    frame=  945 fps= 30 q=-1.0 size=N/A time=00:00:31.53 bitrate=N/A speed=1.02x    frame=  960 fps= 30 q=-1.0 size=N/A time=00:00:32.03 bitrate=N/A speed=1.02x    frame=  975 fps= 30 q=-1.0 size=N/A time=00:00:32.53 bitrate=N/A speed=1.02x    frame=  990 fps= 30 q=-1.0 size=N/A time=00:00:33.03 bitrate=N/A speed=1.02x    frame= 1005 fps= 30 q=-1.0 size=N/A time=00:00:33.53 bitrate=N/A speed=1.02x    frame= 1020 fps= 30 q=-1.0 size=N/A time=00:00:34.03 bitrate=N/A speed=1.02x    frame= 1035 fps= 30 q=-1.0 size=N/A time=00:00:34.53 bitrate=N/A speed=1.02x    frame= 1050 fps= 30 q=-1.0 size=N/A time=00:00:35.03 bitrate=N/A speed=1.02x    frame= 1065 fps= 30 q=-1.0 size=N/A time=00:00:35.53 bitrate=N/A speed=1.02x    frame= 1080 fps= 30 q=-1.0 size=N/A time=00:00:36.03 bitrate=N/A speed=1.01x    frame= 1095 fps= 30 q=-1.0 size=N/A time=00:00:36.54 bitrate=N/A speed=1.01x    frame= 1110 fps= 30 q=-1.0 size=N/A time=00:00:37.04 bitrate=N/A speed=1.01x    frame= 1125 fps= 30 q=-1.0 size=N/A time=00:00:37.54 bitrate=N/A speed=1.01x    frame= 1140 fps= 30 q=-1.0 size=N/A time=00:00:38.04 bitrate=N/A speed=1.01x    frame= 1154 fps= 30 q=-1.0 size=N/A time=00:00:38.51 bitrate=N/A speed=1.01x    frame= 1169 fps= 30 q=-1.0 size=N/A time=00:00:39.01 bitrate=N/A speed=1.01x    frame= 1184 fps= 30 q=-1.0 size=N/A time=00:00:39.51 bitrate=N/A speed=1.01x    frame= 1199 fps= 30 q=-1.0 size=N/A time=00:00:40.01 bitrate=N/A speed=1.01x    frame= 1214 fps= 30 q=-1.0 size=N/A time=00:00:40.51 bitrate=N/A speed=1.01x    frame= 1229 fps= 30 q=-1.0 size=N/A time=00:00:41.01 bitrate=N/A speed=1.01x    frame= 1244 fps= 30 q=-1.0 size=N/A time=00:00:41.51 bitrate=N/A speed=1.01x    frame= 1259 fps= 30 q=-1.0 size=N/A time=00:00:42.01 bitrate=N/A speed=1.01x    frame= 1274 fps= 30 q=-1.0 size=N/A time=00:00:42.51 bitrate=N/A speed=1.01x    frame= 1289 fps= 30 q=-1.0 size=N/A time=00:00:43.01 bitrate=N/A speed=1.01x    frame= 1304 fps= 30 q=-1.0 size=N/A time=00:00:43.51 bitrate=N/A speed=1.01x    frame= 1319 fps= 30 q=-1.0 size=N/A time=00:00:44.01 bitrate=N/A speed=1.01x    frame= 1334 fps= 30 q=-1.0 size=N/A time=00:00:44.51 bitrate=N/A speed=1.01x    frame= 1349 fps= 30 q=-1.0 size=N/A time=00:00:45.01 bitrate=N/A speed=1.01x    frame= 1364 fps= 30 q=-1.0 size=N/A time=00:00:45.51 bitrate=N/A speed=1.01x    frame= 1379 fps= 30 q=-1.0 size=N/A time=00:00:46.02 bitrate=N/A speed=1.01x    frame= 1394 fps= 30 q=-1.0 size=N/A time=00:00:46.52 bitrate=N/A speed=1.01x    frame= 1409 fps= 30 q=-1.0 size=N/A time=00:00:47.02 bitrate=N/A speed=1.01x    frame= 1424 fps= 30 q=-1.0 size=N/A time=00:00:47.52 bitrate=N/A speed=1.01x    frame= 1439 fps= 30 q=-1.0 size=N/A time=00:00:48.02 bitrate=N/A speed=1.01x    frame= 1454 fps= 30 q=-1.0 size=N/A time=00:00:48.52 bitrate=N/A speed=1.01x    frame= 1469 fps= 30 q=-1.0 size=N/A time=00:00:49.02 bitrate=N/A speed=1.01x    frame= 1484 fps= 30 q=-1.0 size=N/A time=00:00:49.52 bitrate=N/A speed=1.01x    2025-12-03 14:26:14,151 - INFO - Stopping...
2025-12-03 14:26:14,179 - ERROR - Error writing frame to GStreamer service: [Errno 32] Broken pipe
2025-12-03 14:26:14,179 - WARNING - Error closing GStreamer service: [Errno 32] Broken pipe
[out#0/rtsp @ 0x5a6db0b22100] video:30201KiB audio:0KiB subtitle:0KiB other streams:0KiB global headers:0KiB muxing overhead: unknown
frame= 1499 fps= 30 q=-1.0 Lsize=N/A time=00:00:50.02 bitrate=N/A speed=1.01x    
Exiting normally, received signal 2.

Stopping FFmpeg...
